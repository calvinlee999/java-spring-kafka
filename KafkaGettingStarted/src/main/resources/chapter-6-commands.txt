
/*******************************************************************
    CHAPTER 6: REAL-WORLD USE CASE - STUDENT MANAGEMENT SYSTEM
    
    This chapter shows you how to build a practical application using Kafka!
    Imagine you're building a system for a school to track student information.
    We'll use Kafka to handle student data messages reliably.
********************************************************************/

/*******************************************************************
                WHAT WE'RE BUILDING:
********************************************************************/

# Scenario: A school wants to track student enrollments, grades, and activities
# We'll use Kafka to:
# 1. Receive student information (like enrollment forms)
# 2. Store it reliably (even if the computer crashes)
# 3. Send updates to different departments (admissions, billing, etc.)

# Think of Kafka like the school's mail system:
# - Students send forms (messages) to different departments (topics)
# - The mail system (Kafka) makes sure every form reaches the right place
# - Multiple departments can read the same form if needed

/*******************************************************************
                STEP 1: CREATE THE STUDENT TOPIC
********************************************************************/

# What are we creating?
# - A "mailbox" (topic) specifically for student information
# - 2 partitions = 2 separate processing lanes (for faster handling)
# - 1 replica = 1 backup copy (keeps data safe)

# Create the topic for student data
./kafka-topics.sh \
    --bootstrap-server localhost:29092 \
    --create \
    --topic kafka.usecase.students \
    --partitions 2 \
    --replication-factor 1

# Why 2 partitions?
# - Allows 2 different student records to be processed at the same time
# - Like having 2 clerks at the admissions office instead of 1

# Why replication-factor 1?
# - This is for learning purposes (normally you'd use 2-3 for safety)
# - In a real school system, you'd want multiple backups!

/*******************************************************************
                STEP 2: INSPECT THE TOPIC
********************************************************************/

# Let's check that our topic was created correctly
# This is like asking "What mailboxes do we have and how are they set up?"

./kafka-topics.sh \
    --bootstrap-server localhost:29092 \
    --topic kafka.usecase.students \
    --describe

# What you'll see:
# - Topic name: kafka.usecase.students
# - Partition count: 2
# - Replication factor: 1
# - Leader information: Which server is handling each partition

/*******************************************************************
                STEP 3: SEND STUDENT DATA (PRODUCER)
********************************************************************/

# Now we'll send student information to our topic
# This is like filling out student forms and putting them in the mailbox

# What makes this special:
# - "parse.key=true": We can use student IDs as keys
# - "key.separator=:": The key and value are separated by a colon (:)

./kafka-console-producer.sh \
    --bootstrap-server localhost:29092 \
    --property "parse.key=true" \
    --property "key.separator=:" \
    --topic kafka.usecase.students

# After running this command, you can type messages like:
# STUDENT001:{"name":"Alice Johnson","grade":"9th","subject":"Math"}
# STUDENT002:{"name":"Bob Smith","grade":"10th","subject":"Science"}

# Why use keys (STUDENT001, STUDENT002)?
# - Keys ensure all messages for the same student go to the same partition
# - This keeps a student's records in order (enrollment, then grades, then activities)
# - Like having a dedicated file folder for each student

# Message format explanation:
# STUDENT001 = Key (Student ID)
# : = Separator
# {"name":"Alice..."} = Value (Student information in JSON format)

/*******************************************************************
                STEP 4: READ STUDENT DATA (CONSUMER)
********************************************************************/

# Now let's read the student information from our topic
# This is like different departments checking their mail

# What this command does:
# - Reads from the students topic
# - Joins a "consumer group" (like a department that reads messages)
# - Shows both the key (student ID) and the value (student info)
# - Starts from the beginning to see all messages

./kafka-console-consumer.sh \
    --bootstrap-server localhost:29092 \
    --topic kafka.usecase.students \
    --group usecase-consumer-group \
    --property print.key=true \
    --property key.separator=" = " \
    --from-beginning

# What you'll see:
# STUDENT001 = {"name":"Alice Johnson","grade":"9th","subject":"Math"}
# STUDENT002 = {"name":"Bob Smith","grade":"10th","subject":"Science"}

# Why use a consumer group?
# - Multiple departments (consumers) can work together
# - Each message is only processed once per group
# - If one department's computer crashes, another can take over

/*******************************************************************
                REAL-WORLD APPLICATIONS:
********************************************************************/

# How would this work in a real school?

# 1. ENROLLMENT PROCESS:
#    - Student submits online application
#    - Application data sent to Kafka topic
#    - Multiple departments automatically get notified:
#      * Admissions (processes application)
#      * Billing (sets up payment account)
#      * IT (creates student login)
#      * Library (creates library card)

# 2. GRADE REPORTING:
#    - Teacher enters grades in system
#    - Grade data sent to Kafka topic
#    - Multiple systems get updated:
#      * Student portal (student sees grades)
#      * Parent portal (parents get notifications)
#      * Transcript system (permanent record)
#      * Counselor system (tracks academic progress)

# 3. ATTENDANCE TRACKING:
#    - Student scans ID card at school entrance
#    - Attendance data sent to Kafka topic
#    - Multiple systems respond:
#      * Attendance office (records presence)
#      * Parent notification system (sends "arrived safely" text)
#      * Security system (tracks who's on campus)

/*******************************************************************
                ADVANCED CONCEPTS DEMONSTRATED:
********************************************************************/

# 1. KEYED MESSAGES:
#    - Using student ID as key ensures message ordering per student
#    - All messages for STUDENT001 will be processed in order

# 2. CONSUMER GROUPS:
#    - Multiple departments can subscribe to the same topic
#    - Each group processes messages independently
#    - Load balancing: if multiple consumers in a group, work is shared

# 3. PERSISTENT STORAGE:
#    - Messages are stored on disk (not just in memory)
#    - System can recover from crashes without losing data
#    - Historical data can be replayed if needed

/*******************************************************************
                TRY THIS YOURSELF:
********************************************************************/

# 1. Start the producer and send some test student data:
#    STUDENT001:{"name":"Alice","grade":"9th","enrolled":"2024-01-15"}
#    STUDENT002:{"name":"Bob","grade":"10th","enrolled":"2024-01-16"}

# 2. Start the consumer in another terminal window to see the messages

# 3. Try sending more data for the same student:
#    STUDENT001:{"action":"grade_update","subject":"Math","grade":"A"}
#    STUDENT001:{"action":"attendance","date":"2024-01-17","status":"present"}

# 4. Notice how all messages for STUDENT001 stay in order!

/*******************************************************************
                WHAT YOU LEARNED:
********************************************************************/

# 1. How to design a topic for a real business use case
# 2. Why keys are important for message ordering
# 3. How consumer groups enable multiple applications to work together
# 4. How Kafka can be the backbone of a school's IT infrastructure
# 5. The difference between keys and values in messages

# This pattern (keyed messages, consumer groups, persistent storage)
# is used by companies like Netflix, Uber, and LinkedIn to handle
# millions of messages per second!