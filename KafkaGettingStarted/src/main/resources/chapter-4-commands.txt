
# ğŸš€ CHAPTER 4: ADVANCED KAFKA CONCEPTS
# 
# ğŸ¯ GOAL: Learn about partitions, message keys, and consumer groups
# Think of this like learning advanced post office features!
#
# ğŸ“š WHAT YOU'LL LEARN:
# - How to create topics with multiple partitions (like multiple mailbox sections)
# - How to use message keys (like zip codes for routing)
# - How consumer groups work together (like mail carrier teams)
# - How to monitor message processing progress (like tracking packages)

# ğŸ“« STEP 1: CREATE TOPIC WITH MULTIPLE PARTITIONS
# Partitions are like having multiple sections in a mailbox for faster processing

./kafka-topics.sh \
    --bootstrap-server localhost:29092 \
    --create \
    --topic kafka.learning.orders \
    --partitions 3 \
    --replication-factor 1

# ğŸ” WHAT'S DIFFERENT THIS TIME:
# - --partitions 3: Creates 3 sections instead of 1
# - More partitions = more parallel processing
# - Like having 3 mail sorting areas instead of 1
#
# ğŸ’¡ WHY USE MULTIPLE PARTITIONS?
# - Faster message processing (3 workers can work simultaneously)
# - Better load distribution
# - Higher throughput (more messages per second)
# - Allows scaling up with more consumers

# ğŸ” STEP 2: EXAMINE TOPIC PARTITIONING
# This shows detailed information about how the topic is organized

./kafka-topics.sh \
    --bootstrap-server localhost:29092 \
    --topic kafka.learning.orders \
    --describe

# ğŸ” WHAT YOU'LL SEE:
# Topic: kafka.learning.orders  PartitionCount: 3  ReplicationFactor: 1
# Partition: 0  Leader: 1  Replicas: 1  Isr: 1
# Partition: 1  Leader: 1  Replicas: 1  Isr: 1  
# Partition: 2  Leader: 1  Replicas: 1  Isr: 1
#
# This means:
# - 3 partitions (0, 1, 2) like 3 separate mailbox sections
# - Each partition is handled by broker 1 (your single Kafka server)
# - All partitions are "in-sync" and ready to use

# ğŸ“¤ STEP 3: SEND MESSAGES WITH KEYS
# Message keys are like zip codes - they determine which partition gets the message

./kafka-console-producer.sh \
    --bootstrap-server localhost:29092 \
    --property "parse.key=true" \
    --property "key.separator=:" \
    --topic kafka.learning.orders

# ğŸ” WHAT THESE PROPERTIES DO:
# - parse.key=true: Tell producer to look for keys in messages
# - key.separator=":": Use colon to separate key from message
#
# ğŸ’¡ HOW TO SEND KEYED MESSAGES:
# Type messages in this format: key:message
# Examples to try:
# customer1:Order for pizza
# customer2:Order for burgers  
# customer1:Update pizza order
# customer3:Order for tacos
#
# ğŸ¯ KEY CONCEPT: Messages with the same key always go to the same partition
# - All "customer1" messages go to the same partition
# - This ensures order is preserved for each customer
# - Like making sure all mail for one address goes to the same mail carrier

# ğŸ“¥ STEP 4: CONSUME WITH CONSUMER GROUP
# Consumer groups allow multiple consumers to work together as a team

./kafka-console-consumer.sh \
    --bootstrap-server localhost:29092 \
    --topic kafka.learning.orders \
    --group test-consumer-group \
    --property print.key=true \
    --property key.separator=" = " \
    --from-beginning

# ğŸ” WHAT THESE OPTIONS DO:
# - --group test-consumer-group: Join this consumer team
# - print.key=true: Show the message keys when displaying messages
# - key.separator=" = ": Show key = message format
# - --from-beginning: Start from first message in topic
#
# ğŸ’¡ CONSUMER GROUP BENEFITS:
# - Multiple consumers can join the same group
# - Each partition is handled by only one consumer in the group
# - If a consumer fails, others take over its partitions
# - Perfect for scaling up message processing

# ğŸ“Š STEP 5: MONITOR CONSUMER GROUP PROGRESS
# This shows how well your consumer group is keeping up with messages

./kafka-consumer-groups.sh \
    --bootstrap-server localhost:29092 \
    --describe \
    --all-groups

# ğŸ” WHAT YOU'LL SEE:
# GROUP              TOPIC               PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG
# test-consumer-group kafka.learning.orders    0          5              5         0
# test-consumer-group kafka.learning.orders    1          3              3         0  
# test-consumer-group kafka.learning.orders    2          2              2         0
#
# ğŸ“‹ UNDERSTANDING THE OUTPUT:
# - GROUP: Consumer group name
# - PARTITION: Which partition (0, 1, 2)
# - CURRENT-OFFSET: Last message this group processed
# - LOG-END-OFFSET: Total messages in partition
# - LAG: How many messages behind (0 = caught up!)

# ğŸ“ ADVANCED CONCEPTS FOR BEGINNERS:

# ğŸ”‘ MESSAGE KEYS:
# - Optional identifier for each message
# - Messages with same key go to same partition
# - Ensures ordering within a key (customer orders stay in order)
# - Like sorting mail by zip code

# ğŸ—‚ï¸ PARTITIONS:
# - Divide topic into smaller, parallel streams
# - Each partition maintains order independently
# - More partitions = more parallel consumers possible
# - Like having multiple checkout lines at a store

# ğŸ‘¥ CONSUMER GROUPS:
# - Team of consumers working together
# - Each partition assigned to one consumer in group
# - Automatic load balancing and failover
# - Like mail carrier teams covering different routes

# ğŸ“ˆ OFFSETS:
# - Position marker in each partition
# - Tracks which messages have been processed
# - Allows resuming from where you left off
# - Like bookmarks in different books

# ğŸ¯ HANDS-ON EXERCISES TO TRY:

# Exercise 1: Key Partitioning Test
# 1. Send 10 messages with key "customer1"
# 2. Send 10 messages with key "customer2"  
# 3. Send 10 messages with key "customer3"
# 4. Use describe to see which partition each key goes to
# 5. Notice same keys always go to same partition

# Exercise 2: Multiple Consumer Test
# 1. Start 3 consumers in the same group (different terminals)
# 2. Send messages and see how they distribute
# 3. Stop one consumer and see partitions rebalance
# 4. Restart consumer and see it rejoin

# Exercise 3: Lag Monitoring
# 1. Send 100 messages quickly
# 2. Start a slow consumer
# 3. Watch lag grow as consumer falls behind
# 4. Add more consumers to catch up

# ğŸš¨ TROUBLESHOOTING TIPS:

# Problem: All messages go to one partition
# Solution: Make sure you're using different keys

# Problem: Consumer group shows no data
# Solution: Make sure group name matches exactly

# Problem: High lag numbers
# Solution: Add more consumers to the group (up to number of partitions)

# Problem: Messages out of order
# Solution: Check if you're using the right keys for ordering requirements

# ğŸ¯ REAL-WORLD APPLICATIONS:
# - E-commerce: Key by customer ID to maintain order history
# - IoT sensors: Key by device ID to track each device separately
# - Banking: Key by account number to process transactions in order
# - Gaming: Key by player ID to maintain game state consistency

